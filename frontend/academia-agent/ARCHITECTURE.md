# NextAuth AWS Cognito Authentication Architecture

## ğŸ—ï¸ System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Browser/Client                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚              app/layout.tsx                          â”‚      â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚      â”‚
â”‚  â”‚  â”‚       AuthProvider (Session Context)       â”‚     â”‚      â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                           â”‚                                      â”‚
â”‚                           â–¼                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚              app/page.tsx (Protected)                â”‚      â”‚
â”‚  â”‚                                                      â”‚      â”‚
â”‚  â”‚  useSession() â”€â”€â–º status === "loading"              â”‚      â”‚
â”‚  â”‚                    â†’ Show Loading Spinner            â”‚      â”‚
â”‚  â”‚                                                      â”‚      â”‚
â”‚  â”‚                   status === "unauthenticated"       â”‚      â”‚
â”‚  â”‚                    â†’ Show AuthCard                   â”‚      â”‚
â”‚  â”‚                                                      â”‚      â”‚
â”‚  â”‚                   status === "authenticated"         â”‚      â”‚
â”‚  â”‚                    â†’ Show Main App                   â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                           â”‚                                      â”‚
â”‚                           â–¼                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚         components/auth-card.tsx                     â”‚      â”‚
â”‚  â”‚                                                      â”‚      â”‚
â”‚  â”‚  â€¢ Terms Checkbox (required)                         â”‚      â”‚
â”‚  â”‚  â€¢ "Sign In" Button                 â”‚      â”‚
â”‚  â”‚  â€¢ Link to /terms                                    â”‚      â”‚
â”‚  â”‚                                                      â”‚      â”‚
â”‚  â”‚  onClick â”€â”€â–º signIn("cognito")                       â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Next.js API Layer                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚     app/api/auth/[...nextauth]/route.ts              â”‚      â”‚
â”‚  â”‚                                                      â”‚      â”‚
â”‚  â”‚  NextAuth({                                          â”‚      â”‚
â”‚  â”‚    providers: [CognitoProvider],                     â”‚      â”‚
â”‚  â”‚    callbacks: { jwt, session },                      â”‚      â”‚
â”‚  â”‚    secret: NEXTAUTH_SECRET                           â”‚      â”‚
â”‚  â”‚  })                                                  â”‚      â”‚
â”‚  â”‚                                                      â”‚      â”‚
â”‚  â”‚  Initiates OAuth 2.0 flow                            â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                           â”‚                                      â”‚
â”‚                           â–¼                                      â”‚
â”‚                    Redirects user to                             â”‚
â”‚                    AWS Cognito Hosted UI                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     AWS Cognito Service                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚            Cognito Hosted UI                         â”‚      â”‚
â”‚  â”‚                                                      â”‚      â”‚
â”‚  â”‚  â€¢ Sign In / Sign Up forms                           â”‚      â”‚
â”‚  â”‚  â€¢ Email verification                                â”‚      â”‚
â”‚  â”‚  â€¢ Password management                               â”‚      â”‚
â”‚  â”‚  â€¢ Forgot password flow                              â”‚      â”‚
â”‚  â”‚  â€¢ Optional: Social login (Google, etc.)             â”‚      â”‚
â”‚  â”‚                                                      â”‚      â”‚
â”‚  â”‚  User authenticates â”€â”€â–º Generates OAuth tokens       â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                           â”‚                                      â”‚
â”‚                           â–¼                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚         Cognito User Pool                            â”‚      â”‚
â”‚  â”‚                                                      â”‚      â”‚
â”‚  â”‚  â€¢ Validates credentials                             â”‚      â”‚
â”‚  â”‚  â€¢ Creates/updates user                              â”‚      â”‚
â”‚  â”‚  â€¢ Issues ID token, access token, refresh token      â”‚      â”‚
â”‚  â”‚                                                      â”‚      â”‚
â”‚  â”‚  Redirects to callback URL with tokens               â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              NextAuth OAuth Callback Handler                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  /api/auth/callback/cognito                                      â”‚
â”‚                                                                  â”‚
â”‚  â€¢ Validates OAuth tokens from Cognito                           â”‚
â”‚  â€¢ Extracts user information                                     â”‚
â”‚  â€¢ Creates NextAuth session                                      â”‚
â”‚  â€¢ Sets secure HTTP-only cookies                                 â”‚
â”‚  â€¢ Redirects user back to application                            â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ Authentication Flow Sequence

```
User                 Browser              Next.js API         AWS Cognito           Cognito Pool
 â”‚                      â”‚                      â”‚                    â”‚                     â”‚
 â”‚ 1. Visit website     â”‚                      â”‚                    â”‚                     â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                      â”‚                    â”‚                     â”‚
 â”‚                      â”‚                      â”‚                    â”‚                     â”‚
 â”‚                      â”‚ 2. Check session     â”‚                    â”‚                     â”‚
 â”‚                      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                    â”‚                     â”‚
 â”‚                      â”‚                      â”‚                    â”‚                     â”‚
 â”‚                      â”‚ 3. No session found  â”‚                    â”‚                     â”‚
 â”‚                      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚                     â”‚
 â”‚                      â”‚                      â”‚                    â”‚                     â”‚
 â”‚ 4. Show AuthCard     â”‚                      â”‚                    â”‚                     â”‚
 â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                      â”‚                    â”‚                     â”‚
 â”‚                      â”‚                      â”‚                    â”‚                     â”‚
 â”‚ 5. Check terms box   â”‚                      â”‚                    â”‚                     â”‚
 â”‚ 6. Click "Sign In"   â”‚                      â”‚                    â”‚                     â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                      â”‚                    â”‚                     â”‚
 â”‚                      â”‚                      â”‚                    â”‚                     â”‚
 â”‚                      â”‚ 7. Call signIn()     â”‚                    â”‚                     â”‚
 â”‚                      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                    â”‚                     â”‚
 â”‚                      â”‚                      â”‚                    â”‚                     â”‚
 â”‚                      â”‚                      â”‚ 8. Redirect to     â”‚                     â”‚
 â”‚                      â”‚                      â”‚    Cognito         â”‚                     â”‚
 â”‚                      â”‚                      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                     â”‚
 â”‚                      â”‚                      â”‚                    â”‚                     â”‚
 â”‚ 9. Redirect to       â”‚                      â”‚                    â”‚                     â”‚
 â”‚    Cognito Hosted UI â”‚                      â”‚                    â”‚                     â”‚
 â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚
 â”‚                      â”‚                      â”‚                    â”‚                     â”‚
 â”‚ 10. Show sign-in/    â”‚                      â”‚                    â”‚                     â”‚
 â”‚     sign-up form     â”‚                      â”‚                    â”‚                     â”‚
 â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚
 â”‚                      â”‚                      â”‚                    â”‚                     â”‚
 â”‚ 11. Enter email +    â”‚                      â”‚                    â”‚                     â”‚
 â”‚     password         â”‚                      â”‚                    â”‚                     â”‚
 â”‚ 12. Submit           â”‚                      â”‚                    â”‚                     â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                      â”‚                    â”‚                     â”‚
 â”‚                      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                     â”‚
 â”‚                      â”‚                      â”‚                    â”‚                     â”‚
 â”‚                      â”‚                      â”‚                    â”‚ 13. Validate        â”‚
 â”‚                      â”‚                      â”‚                    â”‚     credentials     â”‚
 â”‚                      â”‚                      â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
 â”‚                      â”‚                      â”‚                    â”‚                     â”‚
 â”‚                      â”‚                      â”‚                    â”‚ 14. User OK         â”‚
 â”‚                      â”‚                      â”‚                    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚                      â”‚                      â”‚                    â”‚                     â”‚
 â”‚                      â”‚                      â”‚                    â”‚ 15. Issue tokens    â”‚
 â”‚                      â”‚                      â”‚                    â”‚     (ID, Access,    â”‚
 â”‚                      â”‚                      â”‚                    â”‚      Refresh)       â”‚
 â”‚                      â”‚                      â”‚                    â”‚                     â”‚
 â”‚ 16. Redirect to      â”‚                      â”‚                    â”‚                     â”‚
 â”‚     callback URL     â”‚                      â”‚                    â”‚                     â”‚
 â”‚     with auth code   â”‚                      â”‚                    â”‚                     â”‚
 â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚
 â”‚                      â”‚                      â”‚                    â”‚                     â”‚
 â”‚                      â”‚ 17. OAuth callback   â”‚                    â”‚                     â”‚
 â”‚                      â”‚     /api/auth/       â”‚                    â”‚                     â”‚
 â”‚                      â”‚     callback/cognito â”‚                    â”‚                     â”‚
 â”‚                      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                    â”‚                     â”‚
 â”‚                      â”‚                      â”‚                    â”‚                     â”‚
 â”‚                      â”‚                      â”‚ 18. Exchange code  â”‚                     â”‚
 â”‚                      â”‚                      â”‚     for tokens     â”‚                     â”‚
 â”‚                      â”‚                      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                     â”‚
 â”‚                      â”‚                      â”‚                    â”‚                     â”‚
 â”‚                      â”‚                      â”‚ 19. Return tokens  â”‚                     â”‚
 â”‚                      â”‚                      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚
 â”‚                      â”‚                      â”‚                    â”‚                     â”‚
 â”‚                      â”‚                      â”‚ 20. Verify tokens  â”‚                     â”‚
 â”‚                      â”‚                      â”‚                    â”‚                     â”‚
 â”‚                      â”‚                      â”‚ 21. Create session â”‚                     â”‚
 â”‚                      â”‚                      â”‚ 22. Set cookie     â”‚                     â”‚
 â”‚                      â”‚                      â”‚                    â”‚                     â”‚
 â”‚                      â”‚ 23. Redirect to app  â”‚                    â”‚                     â”‚
 â”‚                      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚                     â”‚
 â”‚                      â”‚                      â”‚                    â”‚                     â”‚
 â”‚ 24. Redirect to /    â”‚                      â”‚                    â”‚                     â”‚
 â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                      â”‚                    â”‚                     â”‚
 â”‚                      â”‚                      â”‚                    â”‚                     â”‚
 â”‚ 25. Show main app    â”‚                      â”‚                    â”‚                     â”‚
 â”‚     (authenticated)  â”‚                      â”‚                    â”‚                     â”‚
 â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                      â”‚                    â”‚                     â”‚
```

```

## ğŸ“¦ Component Dependencies

```
app/page.tsx
    â”‚
    â”œâ”€â”€ useSession() from next-auth/react
    â”œâ”€â”€ AuthCard from @/components/auth-card
    â””â”€â”€ Button from @/components/ui/button

components/auth-card.tsx
    â”‚
    â”œâ”€â”€ signIn() from next-auth/react
    â”œâ”€â”€ Card, CardHeader, CardTitle, CardDescription, CardContent from @/components/ui/card
    â”œâ”€â”€ Button from @/components/ui/button
    â”œâ”€â”€ Checkbox from @/components/ui/checkbox
    â”œâ”€â”€ Label from @/components/ui/label
    â””â”€â”€ Link from next/link

components/auth-provider.tsx
    â”‚
    â””â”€â”€ SessionProvider from next-auth/react

app/layout.tsx
    â”‚
    â””â”€â”€ AuthProvider from @/components/auth-provider

app/api/auth/[...nextauth]/route.ts
    â”‚
    â”œâ”€â”€ NextAuth from next-auth
    â”œâ”€â”€ CognitoProvider from next-auth/providers/cognito
    â””â”€â”€ Environment variables (NEXTAUTH_SECRET, COGNITO_CLIENT_ID, etc.)
```

## ğŸ—‚ï¸ Data Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Environment Variables                  â”‚
â”‚  (.env.local)                                            â”‚
â”‚                                                          â”‚
â”‚  â€¢ NEXTAUTH_SECRET                                       â”‚
â”‚  â€¢ COGNITO_CLIENT_ID                                     â”‚
â”‚  â€¢ COGNITO_CLIENT_SECRET                                 â”‚
â”‚  â€¢ COGNITO_ISSUER                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               NextAuth Configuration                      â”‚
â”‚  (app/api/auth/[...nextauth]/route.ts)                   â”‚
â”‚                                                          â”‚
â”‚  Reads env vars and configures:                          â”‚
â”‚  â€¢ Cognito provider                                      â”‚
â”‚  â€¢ OAuth 2.0 flow                                        â”‚
â”‚  â€¢ Session handling                                      â”‚
â”‚  â€¢ JWT and session callbacks                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Session Context                         â”‚
â”‚  (AuthProvider wraps entire app)                         â”‚
â”‚                                                          â”‚
â”‚  Provides session state to all components:               â”‚
â”‚  â€¢ session.user.email                                    â”‚
â”‚  â€¢ session.user.id                                       â”‚
â”‚  â€¢ session.user.name                                     â”‚
â”‚  â€¢ session.user.image                                    â”‚
â”‚  â€¢ session.accessToken (from Cognito)                    â”‚
â”‚  â€¢ status: "loading" | "authenticated" | "unauthenticated"â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   UI Components                           â”‚
â”‚  (page.tsx, auth-card.tsx)                               â”‚
â”‚                                                          â”‚
â”‚  Use session data to:                                     â”‚
â”‚  â€¢ Show/hide auth UI                                     â”‚
â”‚  â€¢ Display user info                                     â”‚
â”‚  â€¢ Enable/disable features                               â”‚
â”‚  â€¢ Handle sign-in/sign-out                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ” Security Layers

```
1. Environment Variables
   â””â”€â–º Secrets stored securely, never committed to git

2. NEXTAUTH_SECRET
   â””â”€â–º Signs and encrypts session tokens

3. CSRF Protection
   â””â”€â–º Built into NextAuth, prevents cross-site attacks

4. OAuth 2.0 Authorization Code Flow
   â””â”€â–º Industry-standard secure authentication

5. AWS Cognito Security Features
   â””â”€â–º Password policies, brute force protection, MFA

6. Secure Cookies
   â””â”€â–º HTTP-only, secure (HTTPS in production)

7. JWT Token Validation
   â””â”€â–º Cognito tokens verified on every request

8. Terms Agreement
   â””â”€â–º Required consent before account creation
```

## ğŸ¨ UI Component Hierarchy

```
app/layout.tsx
â””â”€â”€ AuthProvider
    â””â”€â”€ app/page.tsx
        â”œâ”€â”€ Loading State
        â”‚   â””â”€â”€ Spinner + "Loading..." text
        â”‚
        â”œâ”€â”€ Unauthenticated State
        â”‚   â””â”€â”€ AuthCard
        â”‚       â””â”€â”€ Card
        â”‚           â”œâ”€â”€ CardHeader
        â”‚           â”‚   â”œâ”€â”€ CardTitle: "Welcome to Academia Agent"
        â”‚           â”‚   â””â”€â”€ CardDescription: "Sign in or create..."
        â”‚           â”‚
        â”‚           â””â”€â”€ CardContent
        â”‚               â”œâ”€â”€ Checkbox + Label (terms agreement)
        â”‚               â”‚   â””â”€â”€ Link to /terms
        â”‚               â”œâ”€â”€ Error message (if any)
        â”‚               â”œâ”€â”€ Button: "Sign In with AWS Cognito"
        â”‚               â””â”€â”€ Helper text: "You'll be redirected..."
        â”‚
        â””â”€â”€ Authenticated State
            â””â”€â”€ Main App
                â”œâ”€â”€ Header
                â”‚   â”œâ”€â”€ AI Logo
                â”‚   â”œâ”€â”€ Title + Description
                â”‚   â””â”€â”€ Sign Out Button
                â”œâ”€â”€ Messages Area
                â””â”€â”€ Input Area
```

This architecture provides a complete, secure, and scalable authentication system powered by AWS Cognito!
